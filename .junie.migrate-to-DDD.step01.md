# 🚀 Updated IoT Pilot Server DDD Structure

## 📋 Production-Ready Architecture (FINAL)

```bash
src/
├── app/                           # Next.js App Router (Presentation Layer)
│   ├── (dashboard)/
│   │   ├── devices/
│   │   │   ├── [id]/
│   │   │   │   ├── page.tsx       # Device detail page
│   │   │   │   ├── edit/
│   │   │   │   │   └── page.tsx   # Device edit page
│   │   │   │   ├── metrics/
│   │   │   │   │   └── page.tsx   # Device metrics page
│   │   │   │   └── terminal/
│   │   │   │       └── page.tsx   # SSH terminal page
│   │   │   ├── page.tsx           # Device list page
│   │   │   ├── new/
│   │   │   │   └── page.tsx       # Add device page
│   │   │   └── register/
│   │   │       └── page.tsx       # Device registration page
│   │   ├── monitoring/
│   │   │   ├── page.tsx           # Monitoring dashboard
│   │   │   ├── alerts/
│   │   │   │   ├── page.tsx       # Alerts list
│   │   │   │   └── [id]/
│   │   │   │       └── page.tsx   # Alert details
│   │   │   ├── metrics/
│   │   │   │   └── page.tsx       # System metrics
│   │   │   └── reports/
│   │   │       └── page.tsx       # Reports page
│   │   ├── users/
│   │   │   ├── page.tsx           # User management
│   │   │   ├── [id]/
│   │   │   │   └── page.tsx       # User profile
│   │   │   └── new/
│   │   │       └── page.tsx       # Create user
│   │   ├── analytics/
│   │   │   ├── page.tsx           # Analytics dashboard
│   │   │   └── reports/
│   │   │       └── page.tsx       # Analytics reports
│   │   └── page.tsx               # Main dashboard
│   ├── api/                       # API Routes (Infrastructure Entry Points)
│   │   ├── devices/
│   │   │   ├── route.ts           # GET /api/devices, POST /api/devices
│   │   │   ├── [id]/
│   │   │   │   ├── route.ts       # GET/PUT/DELETE /api/devices/[id]
│   │   │   │   ├── ssh/
│   │   │   │   │   └── route.ts   # POST /api/devices/[id]/ssh
│   │   │   │   ├── metrics/
│   │   │   │   │   └── route.ts   # GET /api/devices/[id]/metrics
│   │   │   │   ├── commands/
│   │   │   │   │   └── route.ts   # POST /api/devices/[id]/commands
│   │   │   │   └── status/
│   │   │   │       └── route.ts   # GET /api/devices/[id]/status
│   │   │   ├── register/
│   │   │   │   └── route.ts       # POST /api/devices/register
│   │   │   └── bulk/
│   │   │       └── route.ts       # POST /api/devices/bulk
│   │   ├── auth/
│   │   │   ├── login/
│   │   │   │   └── route.ts       # POST /api/auth/login
│   │   │   ├── logout/
│   │   │   │   └── route.ts       # POST /api/auth/logout
│   │   │   ├── register/
│   │   │   │   └── route.ts       # POST /api/auth/register
│   │   │   ├── session/
│   │   │   │   └── route.ts       # GET /api/auth/session
│   │   │   └── refresh/
│   │   │       └── route.ts       # POST /api/auth/refresh
│   │   ├── users/
│   │   │   ├── route.ts           # GET /api/users, POST /api/users
│   │   │   ├── [id]/
│   │   │   │   ├── route.ts       # GET/PUT/DELETE /api/users/[id]
│   │   │   │   └── profile/
│   │   │   │       └── route.ts   # GET/PUT /api/users/[id]/profile
│   │   │   └── current/
│   │   │       └── route.ts       # GET /api/users/current
│   │   ├── monitoring/
│   │   │   ├── metrics/
│   │   │   │   └── route.ts       # GET /api/monitoring/metrics
│   │   │   ├── alerts/
│   │   │   │   ├── route.ts       # GET/POST /api/monitoring/alerts
│   │   │   │   └── [id]/
│   │   │   │       └── route.ts   # GET/PUT/DELETE /api/monitoring/alerts/[id]
│   │   │   ├── thresholds/
│   │   │   │   └── route.ts       # GET/POST /api/monitoring/thresholds
│   │   │   └── reports/
│   │   │       └── route.ts       # GET /api/monitoring/reports
│   │   ├── analytics/
│   │   │   ├── reports/
│   │   │   │   └── route.ts       # GET/POST /api/analytics/reports
│   │   │   └── metrics/
│   │   │       └── route.ts       # GET /api/analytics/metrics
│   │   ├── health/
│   │   │   └── route.ts           # GET /api/health
│   │   └── websocket/
│   │       └── route.ts           # WebSocket endpoint
│   ├── login/
│   │   └── page.tsx               # Login page
│   ├── register/
│   │   └── page.tsx               # User registration page
│   ├── error.tsx                  # Global error page
│   ├── loading.tsx                # Global loading page
│   ├── not-found.tsx              # 404 page
│   └── layout.tsx                 # Root layout
│
├── lib/                           # Core DDD Implementation
│   ├── device/                    # 🏢 DEVICE DOMAIN
│   │   ├── application/
│   │   │   ├── commands/
│   │   │   │   ├── register-device/
│   │   │   │   │   ├── register-device.command.ts
│   │   │   │   │   └── register-device.handler.ts
│   │   │   │   ├── update-device/
│   │   │   │   │   ├── update-device.command.ts
│   │   │   │   │   └── update-device.handler.ts
│   │   │   │   ├── remove-device/
│   │   │   │   │   ├── remove-device.command.ts
│   │   │   │   │   └── remove-device.handler.ts
│   │   │   │   ├── activate-device/
│   │   │   │   │   ├── activate-device.command.ts
│   │   │   │   │   └── activate-device.handler.ts
│   │   │   │   ├── deactivate-device/
│   │   │   │   │   ├── deactivate-device.command.ts
│   │   │   │   │   └── deactivate-device.handler.ts
│   │   │   │   ├── execute-ssh-command/
│   │   │   │   │   ├── execute-ssh-command.command.ts
│   │   │   │   │   └── execute-ssh-command.handler.ts
│   │   │   │   └── bulk-register-devices/
│   │   │   │       ├── bulk-register-devices.command.ts
│   │   │   │       └── bulk-register-devices.handler.ts
│   │   │   ├── queries/
│   │   │   │   ├── get-device/
│   │   │   │   │   ├── get-device.query.ts
│   │   │   │   │   └── get-device.handler.ts
│   │   │   │   ├── list-devices/
│   │   │   │   │   ├── list-devices.query.ts
│   │   │   │   │   └── list-devices.handler.ts
│   │   │   │   ├── get-device-metrics/
│   │   │   │   │   ├── get-device-metrics.query.ts
│   │   │   │   │   └── get-device-metrics.handler.ts
│   │   │   │   ├── get-device-status/
│   │   │   │   │   ├── get-device-status.query.ts
│   │   │   │   │   └── get-device-status.handler.ts
│   │   │   │   └── search-devices/
│   │   │   │       ├── search-devices.query.ts
│   │   │   │       └── search-devices.handler.ts
│   │   │   └── services/
│   │   │       ├── device-finder.ts
│   │   │       ├── ssh-session-manager.ts
│   │   │       ├── device-validator.ts
│   │   │       └── metrics-aggregator.ts
│   │   ├── domain/
│   │   │   ├── entities/
│   │   │   │   ├── device.entity.ts
│   │   │   │   ├── device-metrics.entity.ts
│   │   │   │   ├── ssh-session.entity.ts
│   │   │   │   └── device-command.entity.ts
│   │   │   ├── value-objects/
│   │   │   │   ├── device-id.vo.ts
│   │   │   │   ├── device-name.vo.ts
│   │   │   │   ├── ip-address.vo.ts
│   │   │   │   ├── mac-address.vo.ts
│   │   │   │   ├── ssh-credentials.vo.ts
│   │   │   │   ├── device-type.vo.ts
│   │   │   │   ├── device-status.vo.ts
│   │   │   │   └── port.vo.ts
│   │   │   ├── services/
│   │   │   │   ├── device-creator.ts
│   │   │   │   ├── device-updater.ts
│   │   │   │   ├── device-remover.ts
│   │   │   │   ├── ssh-connector.ts
│   │   │   │   ├── metrics-collector.ts
│   │   │   │   └── device-validator.ts
│   │   │   ├── interfaces/
│   │   │   │   ├── device-repository.interface.ts
│   │   │   │   ├── ssh-client.interface.ts
│   │   │   │   ├── metrics-collector.interface.ts
│   │   │   │   └── device-notification.interface.ts
│   │   │   ├── policies/
│   │   │   │   ├── device-exists.policy.ts
│   │   │   │   ├── device-accessible.policy.ts
│   │   │   │   ├── ssh-allowed.policy.ts
│   │   │   │   ├── device-naming.policy.ts
│   │   │   │   └── metric-collection.policy.ts
│   │   │   ├── events/
│   │   │   │   ├── device-registered.event.ts
│   │   │   │   ├── device-updated.event.ts
│   │   │   │   ├── device-removed.event.ts
│   │   │   │   ├── device-connected.event.ts
│   │   │   │   ├── device-disconnected.event.ts
│   │   │   │   ├── ssh-session-started.event.ts
│   │   │   │   ├── ssh-session-ended.event.ts
│   │   │   │   └── metrics-collected.event.ts
│   │   │   └── exceptions/
│   │   │       ├── device-not-found.exception.ts
│   │   │       ├── device-already-exists.exception.ts
│   │   │       ├── ssh-connection-failed.exception.ts
│   │   │       ├── invalid-device-data.exception.ts
│   │   │       └── device-access-denied.exception.ts
│   │   └── infrastructure/
│   │       ├── repositories/
│   │       │   ├── prisma-device.repository.ts
│   │       │   ├── in-memory-device.repository.ts
│   │       │   └── redis-device-cache.repository.ts
│   │       ├── services/
│   │       │   ├── node-ssh-client.ts
│   │       │   ├── telegraf-metrics-collector.ts
│   │       │   ├── docker-stats-collector.ts
│   │       │   ├── mqtt-device-notifier.ts
│   │       │   └── websocket-device-notifier.ts
│   │       ├── dto/
│   │       │   ├── device.dto.ts
│   │       │   ├── device-metrics.dto.ts
│   │       │   ├── ssh-command.dto.ts
│   │       │   └── device-registration.dto.ts
│   │       └── mappers/
│   │           ├── device.mapper.ts
│   │           ├── device-metrics.mapper.ts
│   │           └── ssh-session.mapper.ts
│   │
│   ├── user/                      # 🏢 USER DOMAIN  
│   │   ├── application/
│   │   │   ├── commands/
│   │   │   │   ├── authenticate-user/
│   │   │   │   │   ├── authenticate-user.command.ts
│   │   │   │   │   └── authenticate-user.handler.ts
│   │   │   │   ├── register-user/
│   │   │   │   │   ├── register-user.command.ts
│   │   │   │   │   └── register-user.handler.ts
│   │   │   │   ├── update-user/
│   │   │   │   │   ├── update-user.command.ts
│   │   │   │   │   └── update-user.handler.ts
│   │   │   │   ├── change-password/
│   │   │   │   │   ├── change-password.command.ts
│   │   │   │   │   └── change-password.handler.ts
│   │   │   │   ├── logout-user/
│   │   │   │   │   ├── logout-user.command.ts
│   │   │   │   │   └── logout-user.handler.ts
│   │   │   │   └── refresh-session/
│   │   │   │       ├── refresh-session.command.ts
│   │   │   │       └── refresh-session.handler.ts
│   │   │   ├── queries/
│   │   │   │   ├── get-current-user/
│   │   │   │   │   ├── get-current-user.query.ts
│   │   │   │   │   └── get-current-user.handler.ts
│   │   │   │   ├── get-user-by-id/
│   │   │   │   │   ├── get-user-by-id.query.ts
│   │   │   │   │   └── get-user-by-id.handler.ts
│   │   │   │   ├── list-users/
│   │   │   │   │   ├── list-users.query.ts
│   │   │   │   │   └── list-users.handler.ts
│   │   │   │   ├── validate-session/
│   │   │   │   │   ├── validate-session.query.ts
│   │   │   │   │   └── validate-session.handler.ts
│   │   │   │   └── get-user-profile/
│   │   │   │       ├── get-user-profile.query.ts
│   │   │   │       └── get-user-profile.handler.ts
│   │   │   └── services/
│   │   │       ├── user-finder.ts
│   │   │       ├── session-manager.ts
│   │   │       ├── password-manager.ts
│   │   │       └── profile-manager.ts
│   │   ├── domain/
│   │   │   ├── entities/
│   │   │   │   ├── user.entity.ts
│   │   │   │   ├── user-session.entity.ts
│   │   │   │   ├── user-profile.entity.ts
│   │   │   │   └── user-preferences.entity.ts
│   │   │   ├── value-objects/
│   │   │   │   ├── user-id.vo.ts
│   │   │   │   ├── email.vo.ts
│   │   │   │   ├── password.vo.ts
│   │   │   │   ├── user-role.vo.ts
│   │   │   │   ├── session-token.vo.ts
│   │   │   │   ├── full-name.vo.ts
│   │   │   │   └── username.vo.ts
│   │   │   ├── services/
│   │   │   │   ├── user-creator.ts
│   │   │   │   ├── user-authenticator.ts
│   │   │   │   ├── password-hasher.ts
│   │   │   │   ├── session-creator.ts
│   │   │   │   └── profile-updater.ts
│   │   │   ├── interfaces/
│   │   │   │   ├── user-repository.interface.ts
│   │   │   │   ├── auth-provider.interface.ts
│   │   │   │   ├── session-store.interface.ts
│   │   │   │   └── password-hasher.interface.ts
│   │   │   ├── policies/
│   │   │   │   ├── user-exists.policy.ts
│   │   │   │   ├── valid-credentials.policy.ts
│   │   │   │   ├── session-valid.policy.ts
│   │   │   │   ├── password-strength.policy.ts
│   │   │   │   └── unique-email.policy.ts
│   │   │   ├── events/
│   │   │   │   ├── user-registered.event.ts
│   │   │   │   ├── user-logged-in.event.ts
│   │   │   │   ├── user-logged-out.event.ts
│   │   │   │   ├── user-updated.event.ts
│   │   │   │   ├── password-changed.event.ts
│   │   │   │   └── session-expired.event.ts
│   │   │   └── exceptions/
│   │   │       ├── invalid-credentials.exception.ts
│   │   │       ├── session-expired.exception.ts
│   │   │       ├── user-not-found.exception.ts
│   │   │       ├── email-already-exists.exception.ts
│   │   │       └── weak-password.exception.ts
│   │   └── infrastructure/
│   │       ├── repositories/
│   │       │   ├── prisma-user.repository.ts
│   │       │   └── redis-session.repository.ts
│   │       ├── services/
│   │       │   ├── jwt-auth-provider.ts
│   │       │   ├── bcrypt-password-hasher.ts
│   │       │   ├── redis-session-store.ts
│   │       │   └── email-service.ts
│   │       ├── dto/
│   │       │   ├── user.dto.ts
│   │       │   ├── login.dto.ts
│   │       │   ├── registration.dto.ts
│   │       │   ├── session.dto.ts
│   │       │   └── profile.dto.ts
│   │       └── mappers/
│   │           ├── user.mapper.ts
│   │           ├── session.mapper.ts
│   │           └── profile.mapper.ts
│   │
│   ├── monitoring/                # 🏢 MONITORING DOMAIN
│   │   ├── application/
│   │   │   ├── commands/
│   │   │   │   ├── create-alert/
│   │   │   │   │   ├── create-alert.command.ts
│   │   │   │   │   └── create-alert.handler.ts
│   │   │   │   ├── acknowledge-alert/
│   │   │   │   │   ├── acknowledge-alert.command.ts
│   │   │   │   │   └── acknowledge-alert.handler.ts
│   │   │   │   ├── resolve-alert/
│   │   │   │   │   ├── resolve-alert.command.ts
│   │   │   │   │   └── resolve-alert.handler.ts
│   │   │   │   ├── create-threshold/
│   │   │   │   │   ├── create-threshold.command.ts
│   │   │   │   │   └── create-threshold.handler.ts
│   │   │   │   └── update-threshold/
│   │   │   │       ├── update-threshold.command.ts
│   │   │   │       └── update-threshold.handler.ts
│   │   │   ├── queries/
│   │   │   │   ├── get-system-metrics/
│   │   │   │   │   ├── get-system-metrics.query.ts
│   │   │   │   │   └── get-system-metrics.handler.ts
│   │   │   │   ├── list-alerts/
│   │   │   │   │   ├── list-alerts.query.ts
│   │   │   │   │   └── list-alerts.handler.ts
│   │   │   │   ├── get-alert-details/
│   │   │   │   │   ├── get-alert-details.query.ts
│   │   │   │   │   └── get-alert-details.handler.ts
│   │   │   │   ├── get-thresholds/
│   │   │   │   │   ├── get-thresholds.query.ts
│   │   │   │   │   └── get-thresholds.handler.ts
│   │   │   │   └── generate-report/
│   │   │   │       ├── generate-report.query.ts
│   │   │   │       └── generate-report.handler.ts
│   │   │   └── services/
│   │   │       ├── metrics-aggregator.ts
│   │   │       ├── alert-processor.ts
│   │   │       ├── threshold-evaluator.ts
│   │   │       └── report-generator.ts
│   │   ├── domain/
│   │   │   ├── entities/
│   │   │   │   ├── metric.entity.ts
│   │   │   │   ├── alert.entity.ts
│   │   │   │   ├── threshold.entity.ts
│   │   │   │   └── monitoring-report.entity.ts
│   │   │   ├── value-objects/
│   │   │   │   ├── metric-value.vo.ts
│   │   │   │   ├── alert-severity.vo.ts
│   │   │   │   ├── alert-status.vo.ts
│   │   │   │   ├── time-range.vo.ts
│   │   │   │   ├── threshold-config.vo.ts
│   │   │   │   └── metric-type.vo.ts
│   │   │   ├── services/
│   │   │   │   ├── alert-creator.ts
│   │   │   │   ├── metrics-processor.ts
│   │   │   │   ├── threshold-evaluator.ts
│   │   │   │   ├── notification-dispatcher.ts
│   │   │   │   └── report-composer.ts
│   │   │   ├── interfaces/
│   │   │   │   ├── metrics-repository.interface.ts
│   │   │   │   ├── alert-repository.interface.ts
│   │   │   │   ├── threshold-repository.interface.ts
│   │   │   │   ├── notification-service.interface.ts
│   │   │   │   └── metrics-source.interface.ts
│   │   │   ├── policies/
│   │   │   │   ├── threshold-exceeded.policy.ts
│   │   │   │   ├── alert-rules.policy.ts
│   │   │   │   ├── metric-validation.policy.ts
│   │   │   │   └── notification-rules.policy.ts
│   │   │   ├── events/
│   │   │   │   ├── alert-triggered.event.ts
│   │   │   │   ├── alert-acknowledged.event.ts
│   │   │   │   ├── alert-resolved.event.ts
│   │   │   │   ├── metric-recorded.event.ts
│   │   │   │   ├── threshold-breached.event.ts
│   │   │   │   └── report-generated.event.ts
│   │   │   └── exceptions/
│   │   │       ├── invalid-metric.exception.ts
│   │   │       ├── alert-not-found.exception.ts
│   │   │       ├── threshold-not-found.exception.ts
│   │   │       └── invalid-threshold.exception.ts
│   │   └── infrastructure/
│   │       ├── repositories/
│   │       │   ├── influxdb-metrics.repository.ts
│   │       │   ├── prisma-alert.repository.ts
│   │       │   ├── prisma-threshold.repository.ts
│   │       │   └── redis-metrics-cache.repository.ts
│   │       ├── services/
│   │       │   ├── grafana-dashboard.service.ts
│   │       │   ├── prometheus-collector.ts
│   │       │   ├── email-notification.service.ts
│   │       │   ├── slack-notification.service.ts
│   │       │   └── sms-notification.service.ts
│   │       ├── dto/
│   │       │   ├── metric.dto.ts
│   │       │   ├── alert.dto.ts
│   │       │   ├── threshold.dto.ts
│   │       │   └── report.dto.ts
│   │       └── mappers/
│   │           ├── metric.mapper.ts
│   │           ├── alert.mapper.ts
│   │           ├── threshold.mapper.ts
│   │           └── report.mapper.ts
│   │
│   ├── analytics/                 # 🏢 ANALYTICS DOMAIN (NEW)
│   │   ├── application/
│   │   │   ├── commands/
│   │   │   │   ├── create-report/
│   │   │   │   │   ├── create-report.command.ts
│   │   │   │   │   └── create-report.handler.ts
│   │   │   │   └── schedule-report/
│   │   │   │       ├── schedule-report.command.ts
│   │   │   │       └── schedule-report.handler.ts
│   │   │   ├── queries/
│   │   │   │   ├── get-analytics-data/
│   │   │   │   │   ├── get-analytics-data.query.ts
│   │   │   │   │   └── get-analytics-data.handler.ts
│   │   │   │   └── list-reports/
│   │   │   │       ├── list-reports.query.ts
│   │   │   │       └── list-reports.handler.ts
│   │   │   └── services/
│   │   │       ├── data-aggregator.ts
│   │   │       └── report-builder.ts
│   │   ├── domain/
│   │   │   ├── entities/
│   │   │   │   ├── analytics-report.entity.ts
│   │   │   │   └── data-point.entity.ts
│   │   │   ├── value-objects/
│   │   │   │   ├── report-type.vo.ts
│   │   │   │   └── aggregation-period.vo.ts
│   │   │   ├── services/
│   │   │   │   └── analytics-calculator.ts
│   │   │   ├── interfaces/
│   │   │   │   └── analytics-repository.interface.ts
│   │   │   ├── events/
│   │   │   │   └── report-created.event.ts
│   │   │   └── exceptions/
│   │   │       └── invalid-report-type.exception.ts
│   │   └── infrastructure/
│   │       ├── repositories/
│   │       │   └── prisma-analytics.repository.ts
│   │       ├── dto/
│   │       │   └── analytics-report.dto.ts
│   │       └── mappers/
│   │           └── analytics.mapper.ts
│   │
│   └── shared/                    # 🔧 SHARED KERNEL
│       ├── domain/
│       │   ├── value-objects/
│       │   │   ├── id.vo.ts
│       │   │   ├── email.vo.ts
│       │   │   ├── date-time.vo.ts
│       │   │   ├── ip-address.vo.ts
│       │   │   ├── port.vo.ts
│       │   │   ├── pagination.vo.ts
│       │   │   └── sort-order.vo.ts
│       │   ├── interfaces/
│       │   │   ├── entity.interface.ts
│       │   │   ├── repository.interface.ts
│       │   │   ├── command.interface.ts
│       │   │   ├── query.interface.ts
│       │   │   ├── event.interface.ts
│       │   │   ├── value-object.interface.ts
│       │   │   ├── aggregate-root.interface.ts
│       │   │   └── domain-service.interface.ts
│       │   ├── exceptions/
│       │   │   ├── domain.exception.ts
│       │   │   ├── validation.exception.ts
│       │   │   ├── not-found.exception.ts
│       │   │   ├── unauthorized.exception.ts
│       │   │   ├── forbidden.exception.ts
│       │   │   └── conflict.exception.ts
│       │   ├── events/
│       │   │   ├── domain.event.ts
│       │   │   └── integration.event.ts
│       │   └── specifications/
│       │       ├── specification.interface.ts
│       │       └── composite-specification.ts
│       ├── application/
│       │   ├── bus/
│       │   │   ├── command.bus.ts
│       │   │   ├── query.bus.ts
│       │   │   ├── event.bus.ts
│       │   │   └── middleware/
│       │   │       ├── logging.middleware.ts
│       │   │       ├── validation.middleware.ts
│       │   │       ├── auth.middleware.ts
│       │   │       └── metrics.middleware.ts
│       │   ├── interfaces/
│       │   │   ├── command-handler.interface.ts
│       │   │   ├── query-handler.interface.ts
│       │   │   ├── event-handler.interface.ts
│       │   │   ├── middleware.interface.ts
│       │   │   └── use-case.interface.ts
│       │   ├── dto/
│       │   │   ├── pagination.dto.ts
│       │   │   ├── response.dto.ts
│       │   │   ├── error.dto.ts
│       │   │   └── success.dto.ts
│       │   └── decorators/
│       │       ├── command-handler.decorator.ts
│       │       ├── query-handler.decorator.ts
│       │       ├── event-handler.decorator.ts
│       │       └── validate.decorator.ts
│       └── infrastructure/
│           ├── persistence/
│           │   ├── prisma/
│           │   │   ├── prisma.client.ts
│           │   │   ├── connection.ts
│           │   │   └── migrations/
│           │   ├── redis/
│           │   │   ├── redis.client.ts
│           │   │   └── connection.ts
│           │   ├── influxdb/
│           │   │   ├── influxdb.client.ts
│           │   │   └── connection.ts
│           │   └── mongodb/
│           │       ├── mongodb.client.ts
│           │       └── connection.ts
│           ├── config/
│           │   ├── database.config.ts
│           │   ├── auth.config.ts
│           │   ├── monitoring.config.ts
│           │   ├── redis.config.ts
│           │   ├── mqtt.config.ts
│           │   ├── websocket.config.ts
│           │   └── environment.config.ts
│           ├── middleware/
│           │   ├── auth.middleware.ts
│           │   ├── error.middleware.ts
│           │   ├── logging.middleware.ts
│           │   ├── cors.middleware.ts
│           │   ├── rate-limit.middleware.ts
│           │   └── validation.middleware.ts
│           ├── external/
│           │   ├── mqtt/
│           │   │   ├── mqtt.client.ts
│           │   │   └── mqtt.service.ts
│           │   ├── websocket/
│           │   │   ├── websocket.server.ts
│           │   │   └── websocket.service.ts
│           │   ├── email/
│           │   │   ├── email.client.ts
│           │   │   └── email.service.ts
│           │   └── notification/
│           │       ├── slack.service.ts
│           │       ├── discord.service.ts
│           │       └── sms.service.ts
│           ├── security/
│           │   ├── encryption.ts
│           │   ├── hashing.ts
│           │   ├── jwt.ts
│           │   ├── api-key.ts
│           │   └── rate-limiter.ts
│           └── utils/
│               ├── logger.ts
│               ├── validator.ts
│               ├── mapper.ts
│               ├── date.ts
│               ├── string.ts
│               ├── crypto.ts
│               └── performance.ts
│
├── components/                    # 🎨 SHARED UI COMPONENTS
│   ├── ui/                       # Base UI components (shadcn/ui)
│   │   ├── button.tsx
│   │   ├── input.tsx
│   │   ├── card.tsx
│   │   ├── dialog.tsx
│   │   ├── form.tsx
│   │   ├── table.tsx
│   │   ├── data-table.tsx
│   │   ├── chart.tsx
│   │   ├── tabs.tsx
│   │   ├── dropdown.tsx
│   │   ├── toast.tsx
│   │   ├── modal.tsx
│   │   ├── spinner.tsx
│   │   ├── badge.tsx
│   │   ├── progress.tsx
│   │   └── skeleton.tsx
│   ├── device/                   # Device-specific components
│   │   ├── device-card.tsx
│   │   ├── device-list.tsx
│   │   ├── device-table.tsx
│   │   ├── device-form.tsx
│   │   ├── device-metrics.tsx
│   │   ├── device-status.tsx
│   │   ├── ssh-terminal.tsx
│   │   ├── device-commands.tsx
│   │   ├── device-search.tsx
│   │   └── device-filters.tsx
│   ├── user/                     # User-specific components
│   │   ├── user-profile.tsx
│   │   ├── user-list.tsx
│   │   ├── user-form.tsx
│   │   ├── user-avatar.tsx
│   │   ├── user-menu.tsx
│   │   ├── login-form.tsx
│   │   ├── register-form.tsx
│   │   └── password-form.tsx
│   ├── monitoring/               # Monitoring components
│   │   ├── metrics-chart.tsx
│   │   ├── metrics-dashboard.tsx
│   │   ├── alert-list.tsx
│   │   ├── alert-card.tsx
│   │   ├── alert-form.tsx
│   │   ├── threshold-config.tsx
│   │   ├── dashboard-widget.tsx
│   │   ├── real-time-chart.tsx
│   │   └── system-health.tsx
│   ├── analytics/                # Analytics components
│   │   ├── analytics-dashboard.tsx
│   │   ├── report-builder.tsx
│   │   ├── data-visualization.tsx
│   │   ├── kpi-cards.tsx
│   │   └── trend-charts.tsx
│   ├── layout/                   # Layout components
│   │   ├── sidebar.tsx
│   │   ├── header.tsx
│   │   ├── footer.tsx
│   │   ├── navigation.tsx
│   │   ├── breadcrumbs.tsx
│   │   ├── page-header.tsx
│   │   └── main-layout.tsx
│   └── common/                   # Common components
│       ├── error-boundary.tsx
│       ├── loading-spinner.tsx
│       ├── not-found.tsx
│       ├── search-box.tsx
│       ├── pagination.tsx
│       ├── sort-controls.tsx
│       ├── filter-panel.tsx
│       └── confirmation-dialog.tsx
│
├── hooks/                        # 🎣 CUSTOM REACT HOOKS
│   ├── commands/                 # Command hooks
│   │   ├── use-command.ts        # Generic command execution
│   │   ├── use-device-commands.ts
│   │   ├── use-user-commands.ts
│   │   └── use-monitoring-commands.ts
│   ├── queries/                  # Query hooks
│   │   ├── use-query.ts          # Generic query execution
│   │   ├── use-device-queries.ts
│   │   ├── use-user-queries.ts
│   │   └── use-monitoring-queries.ts
│   ├── domain/                   # Domain-specific hooks
│   │   ├── use-auth.ts           # Authentication state
│   │   ├── use-device-metrics.ts # Real-time device metrics
│   │   ├── use-ssh-session.ts    # SSH session management
│   │   ├── use-websocket.ts      # WebSocket connection
│   │   ├── use-notifications.ts  # Notification system
│   │   └── use-real-time-data.ts # Real-time data updates
│   ├── ui/                       # UI hooks
│   │   ├── use-toast.ts
│   │   ├── use-modal.ts
│   │   ├── use-theme.ts
│   │   ├── use-local-storage.ts
│   │   ├── use-debounce.ts
│   │   └── use-pagination.ts
│   └── utils/                    # Utility hooks
│       ├── use-async.ts
│       ├── use-polling.ts
│       ├── use-interval.ts
│       ├── use-previous.ts
│       └── use-clipboard.ts
│
├── context/                      # ⚛️ REACT CONTEXT (DDD Integration)
│   ├── providers/                # DDD Service Providers
│   │   ├── command-bus.provider.tsx   # Command bus provider
│   │   ├── query-bus.provider.tsx     # Query bus provider
│   │   ├── event-bus.provider.tsx     # Event bus provider
│   │   └── dependency-injection.provider.tsx # DI container
│   ├── domain/                   # Domain contexts
│   │   ├── auth.context.tsx      # Authentication context
│   │   ├── device.context.tsx    # Device management context
│   │   ├── monitoring.context.tsx # Monitoring context
│   │   └── analytics.context.tsx # Analytics context
│   ├── infrastructure/           # Infrastructure contexts
│   │   ├── websocket.context.tsx # WebSocket connections
│   │   ├── notification.context.tsx # Notifications
│   │   ├── theme.context.tsx     # Theme management
│   │   └── realtime.context.tsx  # Real-time data
│   └── app.provider.tsx          # Root app provider
│
├── scripts/                      # 🛠️ BUILD & DEVELOPMENT SCRIPTS
│   ├── cli/                      # DDD CLI Generator
│   │   ├── index.js              # Main CLI entry
│   │   ├── commands/
│   │   │   ├── generate.js       # Generate DDD features
│   │   │   ├── scaffold.js       # Scaffold new domain
│   │   │   ├── validate.js       # Validate DDD structure
│   │   │   └── migrate.js        # Migration helper
│   │   ├── templates/
│   │   │   ├── domain/
│   │   │   │   ├── entity.template.js
│   │   │   │   ├── value-object.template.js
│   │   │   │   ├── service.template.js
│   │   │   │   └── repository.template.js
│   │   │   ├── application/
│   │   │   │   ├── command.template.js
│   │   │   │   ├── query.template.js
│   │   │   │   └── handler.template.js
│   │   │   └── infrastructure/
│   │   │       ├── dto.template.js
│   │   │       └── mapper.template.js
│   │   ├── utils/
│   │   │   ├── file-generator.js
│   │   │   ├── name-converter.js
│   │   │   └── validation.js
│   │   └── __tests__/
│   │       ├── cli.test.js
│   │       └── templates.test.js
│   ├── build/
│   │   ├── build-production.sh
│   │   ├── build-development.sh
│   │   └── optimize.sh
│   ├── database/
│   │   ├── migrate.sh
│   │   ├── seed.sh
│   │   ├── backup.sh
│   │   └── reset.sh
│   ├── deployment/
│   │   ├── docker-build.sh
│   │   ├── k8s-deploy.sh
│   │   └── env-setup.sh
│   └── testing/
│       ├── run-all-tests.sh
│       ├── integration-tests.sh
│       ├── e2e-tests.sh
│       └── performance-tests.sh
│
├── tests/                        # 🧪 COMPREHENSIVE TEST SUITE
│   ├── unit/                     # Unit tests
│   │   ├── lib/
│   │   │   ├── device/
│   │   │   │   ├── domain/
│   │   │   │   │   ├── entities/
│   │   │   │   │   ├── value-objects/
│   │   │   │   │   ├── services/
│   │   │   │   │   └── policies/
│   │   │   │   ├── application/
│   │   │   │   │   ├── commands/
│   │   │   │   │   └── queries/
│   │   │   │   └── infrastructure/
│   │   │   ├── user/
│   │   │   ├── monitoring/
│   │   │   ├── analytics/
│   │   │   └── shared/
│   │   ├── components/
│   │   ├── hooks/
│   │   └── utils/
│   ├── integration/              # Integration tests
│   │   ├── api/
│   │   │   ├── devices.test.ts
│   │   │   ├── auth.test.ts
│   │   │   ├── monitoring.test.ts
│   │   │   └── analytics.test.ts
│   │   ├── database/
│   │   │   ├── repositories.test.ts
│   │   │   └── migrations.test.ts
│   │   └── external/
│   │       ├── mqtt.test.ts
│   │       ├── websocket.test.ts
│   │       └── notifications.test.ts
│   ├── e2e/                      # End-to-end tests
│   │   ├── user-flows/
│   │   │   ├── device-management.spec.ts
│   │   │   ├── user-authentication.spec.ts
│   │   │   ├── monitoring-dashboard.spec.ts
│   │   │   └── analytics-reports.spec.ts
│   │   ├── page-objects/
│   │   │   ├── login.page.ts
│   │   │   ├── dashboard.page.ts
│   │   │   ├── devices.page.ts
│   │   │   └── monitoring.page.ts
│   │   └── fixtures/
│   │       ├── test-data.json
│   │       ├── mock-devices.json
│   │       └── sample-metrics.json
│   ├── performance/              # Performance tests
│   │   ├── load-testing/
│   │   │   ├── api-endpoints.test.ts
│   │   │   └── database-queries.test.ts
│   │   ├── stress-testing/
│   │   │   ├── concurrent-users.test.ts
│   │   │   └── high-traffic.test.ts
│   │   └── benchmark/
│   │       ├── command-handlers.test.ts
│   │       └── query-handlers.test.ts
│   ├── mocks/                    # Test mocks
│   │   ├── repositories/
│   │   ├── external-services/
│   │   ├── websocket/
│   │   └── notifications/
│   ├── fixtures/                 # Test fixtures
│   │   ├── database/
│   │   ├── files/
│   │   └── responses/
│   └── setup/                    # Test setup
│       ├── global-setup.ts
│       ├── test-database.ts
│       ├── mock-services.ts
│       └── test-utils.ts
│
├── docs/                         # 📚 COMPREHENSIVE DOCUMENTATION
│   ├── migration/
│   │   ├── README.md             # Migration overview
│   │   ├── phases/
│   │   │   ├── phase-01.md
│   │   │   ├── phase-02.md
│   │   │   └── ... (all 12 phases)
│   │   ├── architecture.md       # Architecture documentation
│   │   ├── testing.md           # Testing guide
│   │   └── deployment.md        # Deployment guide
│   ├── api/
│   │   ├── devices.md
│   │   ├── auth.md
│   │   ├── monitoring.md
│   │   └── analytics.md
│   ├── domains/
│   │   ├── device-domain.md
│   │   ├── user-domain.md
│   │   ├── monitoring-domain.md
│   │   └── analytics-domain.md
│   ├── patterns/
│   │   ├── cqrs.md
│   │   ├── event-sourcing.md
│   │   ├── repository-pattern.md
│   │   └── value-objects.md
│   ├── development/
│   │   ├── getting-started.md
│   │   ├── coding-standards.md
│   │   ├── cli-usage.md
│   │   └── troubleshooting.md
│   └── deployment/
│       ├── docker.md
│       ├── kubernetes.md
│       ├── monitoring.md
│       └── scaling.md
│
├── docker/                       # 🐳 CONTAINERIZATION
│   ├── Dockerfile
│   ├── Dockerfile.dev
│   ├── docker-compose.yml
│   ├── docker-compose.dev.yml
│   ├── docker-compose.prod.yml
│   └── nginx/
│       ├── nginx.conf
│       └── ssl/
│
├── k8s/                          # ☸️ KUBERNETES MANIFESTS
│   ├── namespace.yaml
│   ├── configmap.yaml
│   ├── secrets.yaml
│   ├── deployment.yaml
│   ├── service.yaml
│   ├── ingress.yaml
│   ├── hpa.yaml
│   └── monitoring/
│       ├── prometheus.yaml
│       ├── grafana.yaml
│       └── alertmanager.yaml
│
├── monitoring/                   # 📊 MONITORING & OBSERVABILITY
│   ├── grafana/
│   │   ├── dashboards/
│   │   │   ├── system-overview.json
│   │   │   ├── device-metrics.json
│   │   │   ├── user-activity.json
│   │   │   └── application-health.json
│   │   └── provisioning/
│   ├── prometheus/
│   │   ├── prometheus.yml
│   │   ├── rules/
│   │   │   ├── device-alerts.yml
│   │   │   ├── system-alerts.yml
│   │   │   └── application-alerts.yml
│   │   └── targets/
│   └── alertmanager/
│       ├── alertmanager.yml
│       └── templates/
│
├── config/                       # ⚙️ CONFIGURATION FILES
│   ├── environments/
│   │   ├── development.env
│   │   ├── staging.env
│   │   ├── production.env
│   │   └── test.env
│   ├── database/
│   │   ├── prisma.schema
│   │   └── migrations/
│   ├── nginx/
│   │   ├── development.conf
│   │   └── production.conf
│   └── ssl/
│       ├── certificates/
│       └── keys/
│
├── public/                       # 🌐 STATIC ASSETS
│   ├── images/
│   │   ├── logos/
│   │   ├── icons/
│   │   └── screenshots/
│   ├── fonts/
│   ├── favicon.ico
│   └── manifest.json
│
├── styles/                       # 🎨 GLOBAL STYLES
│   ├── globals.css
│   ├── components.css
│   ├── utilities.css
│   └── themes/
│       ├── light.css
│       └── dark.css
│
├── types/                        # 📝 TYPESCRIPT DEFINITIONS
│   ├── global.d.ts
│   ├── api.types.ts
│   ├── database.types.ts
│   ├── websocket.types.ts
│   └── environment.d.ts
│
├── utils/                        # 🔧 UTILITY FUNCTIONS
│   ├── constants.ts
│   ├── helpers.ts
│   ├── formatters.ts
│   ├── validators.ts
│   └── test-utils.ts
│
├── migrations/                   # 🗄️ DATABASE MIGRATIONS
│   ├── prisma/
│   └── data/
│       ├── seeds/
│       └── fixtures/
│
├── .github/                      # 🔄 CI/CD & GITHUB
│   ├── workflows/
│   │   ├── ci.yml
│   │   ├── cd.yml
│   │   ├── tests.yml
│   │   ├── security.yml
│   │   └── release.yml
│   ├── ISSUE_TEMPLATE/
│   ├── PULL_REQUEST_TEMPLATE.md
│   └── dependabot.yml
│
├── .vscode/                      # 🛠️ VS CODE CONFIGURATION
│   ├── settings.json
│   ├── extensions.json
│   ├── launch.json
│   └── tasks.json
│
├── middleware.ts                 # 🛡️ NEXT.JS MIDDLEWARE
├── next.config.js                # ⚡ NEXT.JS CONFIGURATION
├── tailwind.config.js            # 🎨 TAILWIND CONFIGURATION
├── postcss.config.js             # 🎨 POSTCSS CONFIGURATION
├── tsconfig.json                 # 📝 TYPESCRIPT CONFIGURATION
├── jest.config.js                # 🧪 JEST CONFIGURATION
├── playwright.config.ts          # 🎭 PLAYWRIGHT CONFIGURATION
├── eslint.config.js              # 📏 ESLINT CONFIGURATION
├── prettier.config.js            # 💅 PRETTIER CONFIGURATION
├── package.json                  # 📦 DEPENDENCIES & SCRIPTS
├── package-lock.json             # 🔒 DEPENDENCY LOCK
├── .env.example                  # 🔧 ENVIRONMENT TEMPLATE
├── .gitignore                    # 🙈 GIT IGNORE
├── .dockerignore                 # 🐳 DOCKER IGNORE
├── README.md                     # 📖 PROJECT README
├── CHANGELOG.md                  # 📝 CHANGE LOG
├── LICENSE                       # ⚖️ LICENSE FILE
└── CONTRIBUTING.md               # 🤝 CONTRIBUTION GUIDE
```

## 🎯 Key Features of This Structure

### ✅ **Production-Ready Architecture**
- **Complete DDD Implementation** with 4 bounded contexts
- **CQRS Pattern** with command/query separation
- **Event-Driven Architecture** for loose coupling
- **Domain Events** for cross-domain communication
- **Clean Architecture** with proper layering

### ✅ **Comprehensive Testing Strategy**
- **Unit Tests** for all domain logic
- **Integration Tests** for API endpoints
- **E2E Tests** for user workflows
- **Performance Tests** for scalability
- **85%+ Test Coverage** target

### ✅ **Developer Experience**
- **CLI Generator** for scaffolding new features
- **Comprehensive Documentation** for all patterns
- **Type Safety** throughout the application
- **Hot Reload** in development
- **VS Code Integration** with optimized settings

### ✅ **Production Deployment**
- **Docker Containerization** for consistent deployment
- **Kubernetes Manifests** for orchestration
- **Monitoring & Observability** with Grafana/Prometheus
- **CI/CD Pipelines** for automated deployment
- **Security** with proper authentication/authorization

### ✅ **Scalability & Performance**
- **Horizontal Scaling** support
- **Caching Strategies** with Redis
- **Database Optimization** with proper indexing
- **WebSocket Support** for real-time features
- **Load Balancing** configuration

### 🚀 **Ready for Production Use**
This structure supports:
- **IoT Device Management** at scale
- **Real-time Monitoring** with alerts
- **User Management** with roles/permissions
- **Analytics & Reporting** capabilities
- **Multi-tenant Architecture** (if needed)

The migration plan transforms your existing IoT Pilot Server into a enterprise-grade, domain-driven application ready for production deployment and long-term maintenance.

## 🔧 Core Infrastructure Setup

### 1. Command & Query Bus System

```typescript
// lib/shared/application/bus/command.bus.ts
export interface CommandBus {
    execute<T>(command: T): Promise<void>;
}

export class InMemoryCommandBus implements CommandBus {
    private handlers = new Map<string, any>();

    register<T>(commandClass: new (...args: any[]) => T, handler: any) {
        this.handlers.set(commandClass.name, handler);
    }

    async execute<T>(command: T): Promise<void> {
        const handler = this.handlers.get(command.constructor.name);
        if (!handler) {
            throw new Error(`No handler found for ${command.constructor.name}`);
        }
        return await handler.handle(command);
    }
}
```

### 2. Event Bus System

```typescript
// lib/shared/application/bus/event.bus.ts
export interface EventBus {
    publish(event: DomainEvent): Promise<void>;

    subscribe<T extends DomainEvent>(
        eventType: string,
        handler: (event: T) => Promise<void>
    ): void;
}

export class InMemoryEventBus implements EventBus {
    private subscribers = new Map<string, Array<(event: any) => Promise<void>>>();

    subscribe<T extends DomainEvent>(
        eventType: string,
        handler: (event: T) => Promise<void>
    ): void {
        if (!this.subscribers.has(eventType)) {
            this.subscribers.set(eventType, []);
        }
        this.subscribers.get(eventType)!.push(handler);
    }

    async publish(event: DomainEvent): Promise<void> {
        const handlers = this.subscribers.get(event.constructor.name) || [];
        await Promise.all(handlers.map(handler => handler(event)));
    }
}
```

### 3. Repository Pattern

```typescript
// lib/shared/domain/interfaces/repository.interface.ts
export interface Repository<T, ID> {
    findById(id: ID): Promise<T | null>;

    findAll(): Promise<T[]>;

    save(entity: T): Promise<void>;

    delete(id: ID): Promise<void>;
}

// lib/device/infrastructure/repositories/prisma-device.repository.ts
export class PrismaDeviceRepository implements DeviceRepository {
    constructor(private prisma: PrismaClient) {
    }

    async findById(id: DeviceId): Promise<Device | null> {
        const deviceData = await this.prisma.device.findUnique({
            where: {id: id.value}
        });

        return deviceData ? DeviceMapper.toDomain(deviceData) : null;
    }

    async save(device: Device): Promise<void> {
        const deviceData = DeviceMapper.toPersistence(device);
        await this.prisma.device.upsert({
            where: {id: deviceData.id},
            update: deviceData,
            create: deviceData
        });
    }
}
```

### 4. React Context for Dependency Injection

```typescript
// context/command-bus.context.tsx
const CommandBusContext = createContext<CommandBus | null>(null);

export function CommandBusProvider({children}: {
    children: ReactNode
}) {
    const commandBus = useMemo(() => {
        const bus = new InMemoryCommandBus();

        // Register handlers
        bus.register(RegisterDeviceCommand, new RegisterDeviceHandler(
            new PrismaDeviceRepository(prisma)
        ));

        return bus;
    }, []);

    return (
        <CommandBusContext.Provider value = {commandBus} >
            {children}
            < /CommandBusContext.Provider>
    );
}

export function useCommandBus() {
    const context = useContext(CommandBusContext);
    if (!context) {
        throw new Error('useCommandBus must be used within CommandBusProvider');
    }
    return context;
}
```

### 5. Custom Hooks for Use Cases

```tsx
// hooks/use-command.ts
export function useCommand<T>() {
    const commandBus = useCommandBus();
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState<string | null>(null);

    const execute = useCallback(async (command: T) => {
        try {
            setLoading(true);
            setError(null);
            await commandBus.execute(command);
        } catch (err) {
            setError(err instanceof Error ? err.message : 'Unknown error');
            throw err;
        } finally {
            setLoading(false);
        }
    }, [commandBus]);

    return {
        execute,
        loading,
        error
    };
}

// Usage in components
function DeviceForm() {
    const {
        execute,
        loading,
        error
    } = useCommand<RegisterDeviceCommand>();

    const handleSubmit = async (data: DeviceFormData) => {
        const command = new RegisterDeviceCommand(
            data.name,
            data.ipAddress,
            data.sshCredentials
        );

        await execute(command);
    };

    return (
        <form onSubmit = {handleSubmit} >
            {/* form fields */}
            < button
    disabled = {loading} >
        {loading ? 'Registering...' : 'Register Device'}
        < /button>
    {
        error && <div className = "error" > {error} < /div>}
            < /form>
    )
        ;
    }
```

## 📁 File Migration Mapping

### Current → Target Structure:

| Current File                    | Target Location                                            | Notes                                                  |
|---------------------------------|------------------------------------------------------------|--------------------------------------------------------|
| src/app/api/devices/route.ts    | src/app/api/devices/route.ts                               | Becomes thin controller calling command/query handlers |
| src/lib/auth.ts                 | src/lib/user/domain/services/auth-service.ts               | Move to user domain                                    |
| src/lib/db.ts                   | src/lib/shared/infrastructure/persistence/prisma.client.ts | Shared infrastructure                                  |
| src/components/device-list.tsx  | src/components/device/device-list.tsx                      | Domain-specific components                             |
| src/components/ssh-terminal.tsx | src/components/device/ssh-terminal.tsx                     | Part of device domain                                  |
| src/contexts/socket.tsx         | src/context/websocket.context.tsx                          | Infrastructure concern                                 |

### New Files to Create:

| File                                                                           | Purpose                           |
|--------------------------------------------------------------------------------|-----------------------------------|
| src/lib/device/application/commands/register-device/register-device.command.ts | Device registration use case      |
| src/lib/device/domain/entities/device.entity.ts                                | Core device business logic        |
| src/lib/device/domain/value-objects/device-id.vo.ts                            | Strong typing for device ID       |
| src/lib/shared/application/bus/command.bus.ts                                  | Command handling infrastructure   |
| src/hooks/use-command.ts                                                       | React hook for command execution  |
| src/context/command-bus.context.tsx                                            | Dependency injection for commands |

This structure maintains your current functionality while introducing proper DDD patterns, making the codebase more
maintainable and testable. The migration can be done incrementally, starting with one domain at a time.

## 📋 IoT Pilot Server DDD Migration Plan

### 🎯 Migration Overview

This plan migrates the IoT Pilot Server from a traditional Next.js structure to a Domain-Driven Design (DDD)architecture
in 12 phases, with each phase being tested and validated before proceeding to the next.

- **Timeline**: 6-8 weeks (assuming part-time work)
- **Strategy**: Incremental migration with backward compatibility
- **Testing**: Comprehensive test coverage at each phase

### 📊 Migration Phases Overview

| Task # | Phase | Focus                                   | Duration | Risk Level |
|--------|-------|-----------------------------------------|----------|------------|
| 1      | 1     | Project Setup & Structure               | 3-5 days | Low        |
| 2      | 2     | Shared Kernel & Infrastructure          | 4-6 days | Medium     |
| 3      | 3     | User Domain Migration                   | 5-7 days | Medium     |
| 4      | 4     | Device Domain - Entities & VOs          | 4-6 days | Low        |
| 5      | 5     | Device Domain - Services & Repositories | 5-7 days | Medium     |
| 6      | 6     | Device Domain - Use Cases               | 6-8 days | High       |
| 7      | 7     | Monitoring Domain Migration             | 5-7 days | Medium     |
| 8      | 8     | API Routes Refactoring                  | 4-6 days | High       |
| 9      | 9     | Frontend Integration                    | 5-7 days | Medium     |
| 10     | 10    | Testing & Validation                    | 3-5 days | Low        |
| 11     | 11    | CLI Generator Development               | 4-6 days | Low        |
| 12     | 12    | Documentation & Cleanup                 | 2-3 days | Low        |

## 🚀 Task 1: Phase 1 - Project Setup & Structure (3-5 days)

### 📁 Task 1.1: Create New Directory Structure

```bash
# Create the new DDD structure
mkdir -p src/lib/{shared,device,user,monitoring}/{domain,application,infrastructure}
mkdir -p src/lib/shared/{domain/{entities,value-objects,interfaces,exceptions,events},application/{bus,interfaces,dto},infrastructure/{persistence,config,middleware,utils}}
mkdir -p src/lib/device/{domain/{entities,value-objects,services,interfaces,policies,events,exceptions},application/{commands,queries,services},infrastructure/{repositories,services,dto,mappers}}
mkdir -p src/lib/user/{domain/{entities,value-objects,services,interfaces,policies,events,exceptions},application/{commands,queries,services},infrastructure/{repositories,services,dto,mappers}}
mkdir -p src/lib/monitoring/{domain/{entities,value-objects,services,interfaces,policies,events,exceptions},application/{commands,queries,services},infrastructure/{repositories,services,dto,mappers}}
mkdir -p src/{components/{ui,device,monitoring,layout},hooks,context,types}
```

### 📦 Task 1.2: Install Required Dependencies

```bash
# DDD and testing dependencies
npm install --save-dev @types/jest jest ts-jest @testing-library/react @testing-library/jest-dom
npm install --save-dev vitest @vitejs/plugin-react jsdom
npm install zod class-validator class-transformer reflect-metadata
npm install mitt eventemitter3 uuid
npm install --save-dev @types/uuid

# Update package.json scripts
```

package.json updates:

```json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "test:e2e": "playwright test",
    "ddd:generate": "node scripts/generate-ddd-feature.js"
  }
}
```

### ⚙️ Task 1.3: Configure Testing Environment

vitest.config.ts:

```typescript
import {defineConfig} from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
    plugins: [react()],
    test: {
        globals: true,
        environment: 'jsdom',
        setupFiles: ['./src/test/setup.ts'],
    },
    resolve: {
        alias: {
            '@': path.resolve(__dirname, './src'),
            '@/lib': path.resolve(__dirname, './src/lib'),
            '@/components': path.resolve(__dirname, './src/components'),
        },
    },
})
```

src/test/setup.ts:

```typescript
import '@testing-library/jest-dom'
import {beforeAll, afterEach, afterAll} from 'vitest'
import {cleanup} from '@testing-library/react'

beforeAll(() => {
    // Setup test environment
})

afterEach(() => {
    cleanup()
})

afterAll(() => {
    // Cleanup test environment
})
```

### ✅ Task 1.4: Phase 1 Validation

- Directory structure created
- Dependencies installed
- Test environment configured
- npm run test executes successfully
- All existing functionality still works